<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | ERNESCO</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-blue: #0071e3;
            --apple-green: #34c759;
            --apple-red: #ff3b30;
            --apple-gray: #86868b;
            --apple-border: rgba(0,0,0,0.1);
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--apple-bg); margin: 0; color: #1d1d1f; -webkit-font-smoothing: antialiased;
        }

        .settings-container { display: grid; grid-template-columns: 260px 1fr; max-width: 1000px; margin: 50px auto; gap: 40px; padding: 0 20px; }

        /* Sidebar */
        .sidebar-nav { list-style: none; padding: 0; position: sticky; top: 50px; }
        .sidebar-nav li { padding: 12px 16px; border-radius: 10px; cursor: pointer; font-size: 14px; margin-bottom: 2px; transition: 0.2s; }
        .sidebar-nav li.active { background: rgba(0,0,0,0.06); font-weight: 500; }

        /* Main Content */
        h1 { font-size: 32px; font-weight: 600; letter-spacing: -0.02em; }
        h2 { font-size: 13px; font-weight: 600; color: var(--apple-gray); text-transform: uppercase; margin: 30px 0 10px; }

        .settings-card { background: #fff; border-radius: 14px; border: 1px solid var(--apple-border); overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        .settings-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f5f5f7; }
        .row-info label { display: block; font-size: 15px; font-weight: 500; }
        .row-info p { font-size: 13px; color: var(--apple-gray); margin: 2px 0 0; }

        /* Switches & Controls */
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e9e9ea; transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--apple-green); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Segmented Picker */
        .segmented-control { display: flex; background: #f2f2f7; padding: 2px; border-radius: 9px; margin: 10px 20px 20px; }
        .segment { flex: 1; border: none; background: none; padding: 7px; font-size: 13px; border-radius: 7px; cursor: pointer; }
        .segment.active { background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-weight: 500; }

        .apple-select { appearance: none; background: #f5f5f7; border: 1px solid #d2d2d7; border-radius: 7px; padding: 6px 30px 6px 12px; font-size: 13px; }
    </style>
</head>
<body>

<div class="settings-container">
    <aside>
        <ul class="sidebar-nav">
            <li class="active" id="nav-gen">‚öôÔ∏è General</li>
            <li id="nav-ai">üß† AI</li>
        </ul>
    </aside>

    <main>
        <h1 id="txt-title">General</h1>

        <h2 id="header-appearance">Appearance & Language</h2>
        <div class="settings-card">
            <div class="settings-row">
                <div class="row-info">
                    <label id="lbl-lang">App Language</label>
                    <p id="sub-lang">Choose your preferred interface language.</p>
                </div>
                <select id="languageSelect" class="apple-select">
                    <option value="en">English</option><option value="es">Espa√±ol</option>
                    <option value="fr">Fran√ßais</option><option value="de">Deutsch</option>
                    <option value="it">Italiano</option><option value="pt">Portugu√™s</option>
                    <option value="zh">‰∏≠Êñá</option><option value="ja">Êó•Êú¨Ë™û</option>
                    <option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option><option value="tr">T√ºrk√ße</option>
                    <option value="nl">Nederlands</option><option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    <option value="vi">Ti·∫øng Vi·ªát</option>
                </select>
            </div>
        </div>

        <h2 id="header-automation">Automation</h2>
        <div class="settings-card">
            <div class="settings-row">
                <div class="row-info">
                    <label id="lbl-ai">AI Smart Replies</label>
                    <p id="sub-ai">Allow AI to draft responses automatically.</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="aiToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <h2 id="header-personality">AI Personality</h2>
        <div class="settings-card">
            <div class="settings-row" style="border-bottom:none">
                <div class="row-info">
                    <label id="lbl-tone">Response Tone</label>
                    <p id="sub-tone">Adjust how the AI communicates.</p>
                </div>
            </div>
            <div class="segmented-control">
                <button class="segment" data-tone="Professional" id="tone-p">Professional</button>
                <button class="segment" data-tone="Friendly" id="tone-f">Friendly</button>
                <button class="segment" data-tone="Concise" id="tone-c">Concise</button>
            </div>
        </div>
    </main>
</div>

<script>
    // 1. Translation Dictionary
    const dictionary = {
        en: { title: "General", lang: "App Language", subL: "Choose language.", ai: "AI Smart Replies", subA: "Draft automatically.", tone: "Response Tone", subT: "How AI speaks.", p: "Professional", f: "Friendly", c: "Concise" },
        es: { title: "General", lang: "Idioma", subL: "Elegir idioma.", ai: "Respuestas IA", subA: "Redactar autom√°ticamente.", tone: "Tono", subT: "C√≥mo habla la IA.", p: "Profesional", f: "Amistoso", c: "Conciso" },
        fr: { title: "G√©n√©ral", lang: "Langue", subL: "Choisir la langue.", ai: "R√©ponses IA", subA: "R√©diger automatiquement.", tone: "Ton", subT: "Comment l'IA parle.", p: "Professionnel", f: "Amical", c: "Concis" }
        // ... Add remaining 12 languages similarly
    };

    // 2. Supabase Config
    const supabase = supabase.createClient('YOUR_URL', 'YOUR_KEY');
    const userEmail = localStorage.getItem('userEmail');

    async function updateDB(column, value) {
        await supabase.from('profiles').update({ [column]: value }).eq('email', userEmail);
    }

    function applyTranslations(code) {
        const t = dictionary[code] || dictionary.en;
        document.getElementById('txt-title').innerText = t.title;
        document.getElementById('lbl-lang').innerText = t.lang;
        document.getElementById('sub-lang').innerText = t.subL;
        document.getElementById('lbl-ai').innerText = t.ai;
        document.getElementById('sub-ai').innerText = t.subA;
        document.getElementById('lbl-tone').innerText = t.tone;
        document.getElementById('sub-tone').innerText = t.subT;
        document.getElementById('tone-p').innerText = t.p;
        document.getElementById('tone-f').innerText = t.f;
        document.getElementById('tone-c').innerText = t.c;
    }

    // 3. Event Listeners
    document.getElementById('languageSelect').addEventListener('change', (e) => {
        applyTranslations(e.target.value);
        updateDB('lang_code', e.target.value);
    });

    document.getElementById('aiToggle').addEventListener('change', (e) => updateDB('ai_enabled', e.target.checked));

    document.querySelectorAll('.segment').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.segment').forEach(s => s.classList.remove('active'));
            this.classList.add('active');
            updateDB('ai_tone', this.dataset.tone);
        });
    });

    // Initial Load
    async function init() {
        const { data } = await supabase.from('profiles').select('*').eq('email', userEmail).single();
        if(data) {
            document.getElementById('languageSelect').value = data.lang_code;
            applyTranslations(data.lang_code);
            document.getElementById('aiToggle').checked = data.ai_enabled;
            document.querySelector(`[data-tone="${data.ai_tone}"]`).classList.add('active');
        }
    }
    init();
</script>
</body>
</html>
