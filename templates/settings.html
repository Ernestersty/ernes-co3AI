<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | ERNESCO</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-blue: #0071e3;
            --apple-green: #34c759;
            --apple-gray: #86868b;
            --apple-border: rgba(0,0,0,0.1);
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--apple-bg); margin: 0; color: #1d1d1f;
        }

        .settings-container { 
            display: grid; grid-template-columns: 260px 1fr; 
            max-width: 1000px; margin: 50px auto; gap: 40px; padding: 0 20px; 
        }

        /* Sidebar */
        .sidebar-nav { list-style: none; padding: 0; position: sticky; top: 50px; }
        .sidebar-nav li { padding: 12px 16px; border-radius: 10px; cursor: pointer; font-size: 14px; margin-bottom: 2px; }
        .sidebar-nav li.active { background: rgba(0,0,0,0.06); font-weight: 600; }

        /* Card Styling */
        .settings-card { background: #fff; border-radius: 14px; border: 1px solid var(--apple-border); overflow: hidden; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        .settings-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f5f5f7; }
        .row-info label { display: block; font-size: 15px; font-weight: 500; }
        .row-info p { font-size: 13px; color: var(--apple-gray); margin-top: 2px; }

        /* Controls */
        .apple-select { appearance: none; background: #f5f5f7; border: 1px solid #d2d2d7; border-radius: 8px; padding: 8px 32px 8px 12px; font-size: 13px; cursor: pointer; }
        .segmented-control { display: flex; background: #f2f2f7; padding: 2px; border-radius: 9px; margin: 10px 20px 20px; }
        .segment { flex: 1; border: none; background: none; padding: 8px; font-size: 13px; border-radius: 7px; cursor: pointer; transition: 0.2s; }
        .segment.active { background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-weight: 500; }

        /* Preview Area */
        .preview-box { background: #fbfbfd; border: 1px dashed #d2d2d7; border-radius: 10px; margin: 20px; padding: 15px; font-style: italic; color: #424245; font-size: 14px; }
    </style>
</head>
<body>

<div class="settings-container" id="mainContainer">
    <aside>
        <ul class="sidebar-nav">
            <li class="active" id="nav-general">‚öôÔ∏è General</li>
            <li id="nav-ai">üß† AI Preference</li>
        </ul>
    </aside>

    <main>
        <h1 id="txt-title">General</h1>

        <h2 id="header-lang">Language</h2>
        <div class="settings-card">
            <div class="settings-row">
                <div class="row-info">
                    <label id="lbl-lang">App Language</label>
                    <p id="sub-lang">Choose your preferred interface language.</p>
                </div>
                <select id="languageSelect" class="apple-select">
                    <option value="en">English</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="sw">Kiswahili</option>
                    <option value="zu">isiZulu</option>
                    <option value="ur">ÿßÿ±ÿØŸà (Urdu)</option>
                    <option value="de">Deutsch</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="es">Espa√±ol</option>
                </select>
            </div>
        </div>

        <h2 id="header-personality">Personality</h2>
        <div class="settings-card">
            <div class="settings-row" style="border:none">
                <div class="row-info">
                    <label id="lbl-tone">Response Tone</label>
                    <p id="sub-tone">How the AI speaks to others.</p>
                </div>
            </div>
            <div class="segmented-control">
                <button class="segment" data-tone="Professional" id="btn-p">Professional</button>
                <button class="segment" data-tone="Friendly" id="btn-f">Friendly</button>
                <button class="segment" data-tone="Concise" id="btn-c">Concise</button>
            </div>
            <div id="preview-area" class="preview-box">
                "AI is drafting a preview..."
            </div>
        </div>
    </main>
</div>

<script>
    const translations = {
        en: { title: "General", lang: "App Language", subL: "Choose language.", tone: "Response Tone", subT: "How AI speaks.", p: "Professional", f: "Friendly", c: "Concise", prev: "Hello, I have received your message and will respond shortly." },
        fr: { title: "G√©n√©ral", lang: "Langue de l'application", subL: "Choisissez la langue.", tone: "Ton de r√©ponse", subT: "Comment l'IA parle.", p: "Professionnel", f: "Amical", c: "Concis", prev: "Bonjour, j'ai bien re√ßu votre message et je vous r√©pondrai sous peu." },
        sw: { title: "Jumla", lang: "Lugha ya Programu", subL: "Chagua lugha.", tone: "Sauti ya AI", subT: "Jinsi AI inavyosema.", p: "Kitalaam", f: "Kirafiki", c: "Fupi", prev: "Habari, nimepokea ujumbe wako na nitajibu hivi karibuni." },
        zu: { title: "Okuvamile", lang: "Ulimi lwe-App", subL: "Khetha ulimi.", tone: "Iphimbo", subT: "Indlela i-AI ekhuluma ngayo.", p: "Ngokomsebenzi", f: "Ngobungane", c: "Kafushane", prev: "Sawubona, ngiyitholile imilayezo yakho futhi ngizophendula maduze." },
        ur: { title: "ÿπÿßŸÖ", lang: "ÿß€åŸæ ⁄©€å ÿ≤ÿ®ÿßŸÜ", subL: "ÿ≤ÿ®ÿßŸÜ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫€î", tone: "ŸÑ€Åÿ¨€Å", subT: "ÿß€í ÿ¢ÿ¶€å ⁄©€åÿ≥€í ÿ®ÿßÿ™ ⁄©ÿ±ÿ™€å €Å€í€î", p: "Ÿæ€åÿ¥€Å Ÿàÿ±ÿßŸÜ€Å", f: "ÿØŸàÿ≥ÿ™ÿßŸÜ€Å", c: "ÿ¨ÿßŸÖÿπ", prev: "€Å€åŸÑŸàÿå ŸÖÿ¨⁄æ€í ÿ¢Ÿæ ⁄©ÿß Ÿæ€åÿ∫ÿßŸÖ ŸÖŸÑ ⁄Ø€åÿß €Å€í ÿßŸàÿ± ŸÖ€å⁄∫ ÿ¨ŸÑÿØ €Å€å ÿ¨Ÿàÿßÿ® ÿØŸà⁄∫ ⁄Øÿß€î" },
        de: { title: "Allgemein", lang: "App-Sprache", subL: "Sprache w√§hlen.", tone: "Antwortton", subT: "Wie die KI spricht.", p: "Professionell", f: "Freundlich", c: "Pr√§gnant", prev: "Hallo, ich habe Ihre Nachricht erhalten und werde in K√ºrze antworten." },
        bn: { title: "‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£", lang: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶≠‡¶æ‡¶∑‡¶æ", subL: "‡¶≠‡¶æ‡¶∑‡¶æ ‡¶ö‡¶Ø‡¶º‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", tone: "‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®", subT: "AI ‡¶Ø‡ßá‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßá‡•§", p: "‡¶™‡ßá‡¶∂‡¶æ‡¶¶‡¶æ‡¶∞", f: "‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£", c: "‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§", prev: "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã, ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶¨‡•§" },
        es: { title: "General", lang: "Idioma", subL: "Elegir idioma.", tone: "Tono", subT: "C√≥mo habla la IA.", p: "Profesional", f: "Amistoso", c: "Conciso", prev: "Hola, he recibido su mensaje y le responder√© a la brevedad." }
    };

    function updateUI(langCode) {
        const t = translations[langCode] || translations.en;
        document.getElementById('txt-title').innerText = t.title;
        document.getElementById('lbl-lang').innerText = t.lang;
        document.getElementById('sub-lang').innerText = t.subL;
        document.getElementById('lbl-tone').innerText = t.tone;
        document.getElementById('sub-tone').innerText = t.subT;
        document.getElementById('btn-p').innerText = t.p;
        document.getElementById('btn-f').innerText = t.f;
        document.getElementById('btn-c').innerText = t.c;
        document.getElementById('preview-area').innerText = t.prev;

        // RTL Support for Urdu
        if (langCode === 'ur') {
            document.documentElement.dir = "rtl";
            document.getElementById('mainContainer').style.gridTemplateColumns = "1fr 260px";
        } else {
            document.documentElement.dir = "ltr";
            document.getElementById('mainContainer').style.gridTemplateColumns = "260px 1fr";
        }
    }

    // Logic to simulate tone changes in the preview
    function updatePreview(tone, lang) {
        const t = translations[lang] || translations.en;
        let text = t.prev;
        if(tone === "Concise") text = text.split('.')[0] + ".";
        if(tone === "Friendly") text = "üëã " + text;
        document.getElementById('preview-area').innerText = text;
    }

    const supabase = supabase.createClient('YOUR_URL', 'YOUR_KEY');
    const userEmail = localStorage.getItem('userEmail');

    document.getElementById('languageSelect').addEventListener('change', async (e) => {
        updateUI(e.target.value);
        await supabase.from('profiles').update({ lang_code: e.target.value }).eq('email', userEmail);
    });

    document.querySelectorAll('.segment').forEach(btn => {
        btn.addEventListener('click', async function() {
            document.querySelectorAll('.segment').forEach(s => s.classList.remove('active'));
            this.classList.add('active');
            updatePreview(this.dataset.tone, document.getElementById('languageSelect').value);
            await supabase.from('profiles').update({ ai_tone: this.dataset.tone }).eq('email', userEmail);
        });
    });

    async function load() {
        const { data } = await supabase.from('profiles').select('*').eq('email', userEmail).single();
        if (data) {
            document.getElementById('languageSelect').value = data.lang_code;
            updateUI(data.lang_code);
            const activeBtn = document.querySelector(`[data-tone="${data.ai_tone}"]`);
            if(activeBtn) activeBtn.classList.add('active');
        }
    }
    load();
</script>
</body>
                        </html>
